var gameLogic;!function(a){function b(){for(var b=[],c=0;c<a.ROWS;c++){b[c]=[];for(var d=0;d<a.COLS;d++)b[c][d]={playerId:-1,numMolecules:0}}return b}function c(){return{board:b(),delta:null}}function d(a){return!1}function e(a){return f(0,a)?"0":f(1,a)?"1":""}function f(b,c){for(var d=0,e=0;e<a.ROWS;e++)for(var f=0;f<a.COLS;f++){var g=c[e][f];if(d+=g.numMolecules,0!==g.numMolecules&&g.playerId!==b)return!1}return 2>d?!1:!0}function g(a,b,f,g){a||(a=c());var h=a.board;if(h[b][f].playerId!==g&&-1!==h[b][f].playerId)throw new Error("One can only make a move in an empty position or its own color!");if(""!==e(h)||d(h))throw new Error("Can only make a move if the game is not over!");var j=angular.copy(h);j[b][f].playerId=g,j[b][f].numMolecules++;var k=i(b,f,j,g);log.log(k.delta.currMoveCell),log.log(k.delta.explosions[0]);var l,m,n=e(j);return""!==n||d(j)?(m=-1,l="0"===n?[1,0]:"1"===n?[0,1]:[0,0]):(m=1-g,l=null),{endMatchScores:l,turnIndexAfterMove:m,stateAfterMove:k}}function h(b,c){var d=4;return(0==b||b==a.ROWS-1)&&d--,(0==c||c==a.COLS-1)&&d--,d}function i(a,b,c,d){var e={row:a,col:b},g=[];if(c[a][b].numMolecules<h(a,b)){var i={currMoveCell:e,explosions:g},j={delta:i,board:c};return j}for(var k=[e],l=[],m={cellsExploded:[],boardAfterExplosions:c};k.length>0;){var n=angular.copy(k[0]);k.splice(0,1),c[n.row][n.col].numMolecules=c[n.row][n.col].numMolecules-h(n.row,n.col),0===c[n.row][n.col].numMolecules&&(c[n.row][n.col].playerId=-1);try{if(c[n.row-1][n.col].playerId=d,c[n.row-1][n.col].numMolecules++,c[n.row-1][n.col].numMolecules===h(n.row-1,n.col)){var o={row:n.row-1,col:n.col};l.push(o)}}catch(p){}try{if(c[n.row+1][n.col].playerId=d,c[n.row+1][n.col].numMolecules++,c[n.row+1][n.col].numMolecules===h(n.row+1,n.col)){var o={row:n.row+1,col:n.col};l.push(o)}}catch(p){}try{if(c[n.row][n.col-1].playerId=d,c[n.row][n.col-1].numMolecules++,c[n.row][n.col-1].numMolecules===h(n.row,n.col-1)){var o={row:n.row,col:n.col-1};l.push(o)}}catch(p){}try{if(c[n.row][n.col+1].playerId=d,c[n.row][n.col+1].numMolecules++,c[n.row][n.col+1].numMolecules===h(n.row,n.col+1)){var o={row:n.row,col:n.col+1};l.push(o)}}catch(p){}if(m.cellsExploded.push(n),m.boardAfterExplosions=angular.copy(c),f(d,c)){g.push(m);var q={currMoveCell:e,explosions:g},r={delta:q,board:c};return r}0==k.length&&(k=angular.copy(l),l=[],g.push(angular.copy(m)),m.cellsExploded=[],m.boardAfterExplosions=angular.copy(c))}var s={currMoveCell:e,explosions:g};log.log("delta"),log.log(s);var t={delta:s,board:c};return t}function j(a){var b=a.turnIndexBeforeMove,c=a.stateBeforeMove,d=a.move,e=a.move.stateAfterMove.delta,f=e.currMoveCell.row,h=e.currMoveCell.col,i=g(c,f,h,b);if(!angular.equals(d,i))throw new Error("Expected move="+angular.toJson(i,!0)+", but got stateTransition="+angular.toJson(a,!0))}function k(){var b=a.createMove(null,0,0,0);log.log("move=",b);var c={turnIndexBeforeMove:0,stateBeforeMove:null,move:b,numberOfPlayers:2};a.checkMoveOk(c)}a.ROWS=6,a.COLS=4,a.getInitialState=c,a.createMove=g,a.checkMoveOk=j,a.forSimpleTestHtml=k}(gameLogic||(gameLogic={}));var game;!function(a){function b(){translate.setTranslations(c()),translate.setLanguage("en"),log.log("Translation of 'RULES_OF_CHAINREACTION' is "+translate("RULES_OF_CHAINREACTION")),resizeGameAreaService.setWidthToHeight(.67),moveService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,checkMoveOk:gameLogic.checkMoveOk,updateUI:f}),document.addEventListener("animationend",d,!1),document.addEventListener("webkitAnimationEnd",d,!1),document.addEventListener("oanimationend",d,!1);var a=window;a.HTMLInspector&&setInterval(function(){a.HTMLInspector.inspect({excludeRules:["unused-classes","script-placement"]})},3e3)}function c(){return{RULES_OF_CHAINREACTION:{en:"Rules of Chain Reaction",iw:"חוקי המשחק"},RULES_SLIDE1:{en:"You and your opponent take turns to occupy the cells by putting their balls in them. A ball can be put in an empty cell or a cell already occupied by you",iw:"אתה והיריב מסמנים איקס או עיגול כל תור"},RULES_SLIDE2:{en:"A cell explodes and occupies the neighboring cells if the number of balls in it becomes equal to the number of neighbors it has",iw:"הראשון שמסמן שורה, עמודה או אלכסון מנצח"},RULES_SLIDE3:{en:"The player who wipes out the other player's occupied cells wins.",iw:"הראשון שמסמן שורה, עמודה או אלכסון מנצח"},CLOSE:{en:"Close",iw:"סגור"}}}function d(){$rootScope.$apply(function(){log.info("Animation ended"),a.animationEnded=!0,e()})}function e(){a.isComputerTurn&&(a.isComputerTurn=!1,moveService.makeMove(aiService.findComputerMove(a.move)))}function f(b){log.info("Game got updateUI:",b),a.animationEnded=!1,a.move=b.move,a.state=a.move.stateAfterMove,a.state||(a.state=gameLogic.getInitialState()),a.canMakeMove=a.move.turnIndexAfterMove>=0&&b.yourPlayerIndex===a.move.turnIndexAfterMove,a.isComputerTurn=a.canMakeMove&&""===b.playersInfo[b.yourPlayerIndex].playerId,a.isComputerTurn&&(a.canMakeMove=!1,a.state.delta||e())}function g(b,c){if(log.info("Clicked on cell:",b,c),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.canMakeMove)try{var d=gameLogic.createMove(a.state,b,c,a.move.turnIndexAfterMove);a.canMakeMove=!1,moveService.makeMove(d)}catch(e){return void log.info(["Cell is already full in position:",b,c])}}function h(b,c){var d=a.state.board[b][c];return-1!==d.playerId}function i(b,c,d,e){return a.state.board[b][c].playerId===d&&a.state.board[b][c].numMolecules==e}function j(b){return b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.isHelpModalShown=!1),!0}a.animationEnded=!1,a.canMakeMove=!1,a.isComputerTurn=!1,a.move=null,a.state=null,a.isHelpModalShown=!1,a.init=b,a.cellClicked=g,a.shouldShowImage=h,a.containsMolOfPlayer=i,a.clickedOnModal=j}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,game.init()});var aiService;!function(a){function b(a){return d(a,{millisecondsLimit:1e3})}function c(a,b){for(var c=[],d=0;d<gameLogic.ROWS;d++)for(var e=0;e<gameLogic.COLS;e++)try{c.push(gameLogic.createMove(a,d,e,b))}catch(f){}return c}function d(a,b){return alphaBetaService.alphaBetaDecision(a,a.turnIndexAfterMove,f,e,null,b)}function e(a,b){var c=a.endMatchScores;return c?c[0]>c[1]?Number.POSITIVE_INFINITY:c[0]<c[1]?Number.NEGATIVE_INFINITY:0:0}function f(a,b){return c(a.stateAfterMove,b)}a.findComputerMove=b,a.getPossibleMoves=c,a.createComputerMove=d}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map